#!/usr/bin/env sh

# Initialize nvm for non-interactive shells
# This ensures we use the correct Node.js version (v24.6.0) for native module compatibility
export NVM_DIR="${NVM_DIR:-$HOME/.nvm}"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

echo "ğŸš€ Running pre-push checks..."
echo "â±ï¸  This will run the full test suite (~8 seconds)"

# Run the full test suite
npm test

if [ $? -ne 0 ]; then
  echo "âŒ Tests failed! Please fix the failing tests before pushing."
  echo "ğŸ’¡ To bypass: git push --no-verify"
  exit 1
fi

echo "âœ… All tests passed! Pushing to remote..."